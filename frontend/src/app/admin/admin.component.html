<div class="admin-container">
  <!-- Toolbar avec bouton retour -->
  <div class="admin-toolbar">
    <a class="btn btn-secondary" [routerLink]="['/']">
      <i class="fas fa-arrow-left"></i>
      <span>Retour aux guides</span>
    </a>
  </div>

  <!-- Header -->
  <div class="admin-header">
    <h1>Administration</h1>
    <p>Gère les utilisateurs, les guides et les invitations.</p>
  </div>

  <!-- Tabs -->
  <div class="admin-tabs">
    <button class="tab-button" [class.active]="activeTab === 'users'" (click)="setActiveTab('users')">
      <i class="fas fa-users me-2"></i> Utilisateurs
    </button>
    <button class="tab-button" [class.active]="activeTab === 'guides'" (click)="setActiveTab('guides')">
      <i class="fas fa-map-marked-alt me-2"></i> Guides
    </button>
    <button class="tab-button" [class.active]="activeTab === 'invitations'" (click)="setActiveTab('invitations')">
      <i class="fas fa-envelope me-2"></i> Invitations
    </button>
  </div>

  <!-- Content: USERS -->
  <div class="tab-content" *ngIf="activeTab === 'users'">
    <div class="section-header">
      <h2>Gestion des Utilisateurs</h2>
      <button class="btn btn-primary" (click)="openCreateUserModal()">
        <i class="fas fa-plus me-2"></i>Créer un utilisateur
      </button>
    </div>

    <div *ngIf="users?.length === 0" class="empty-state">
      <i class="fas fa-user-slash"></i>
      <p>Aucun utilisateur pour le moment.</p>
    </div>

    <table *ngIf="users?.length" class="data-table">
      <thead>
        <tr>
          <th>ID</th>
          <th>Nom</th>
          <th>Email</th>
          <th>Rôle</th>
          <th>Statut</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let user of users">
          <td>{{ user.id }}</td>
          <td>{{ user.username }}</td>
          <td>{{ user.email }}</td>
          <td>
            <span class="role-badge" [class.admin]="user.role === 'admin'" [class.user]="user.role !== 'admin'">
              {{ user.role === 'admin' ? 'Administrateur' : 'Utilisateur' }}
            </span>
          </td>
          <td>
            <span class="status-badge" [class.ok]="user.is_active" [class.muted]="!user.is_active">
              {{ user.is_active ? 'Actif' : 'Inactif' }}
            </span>
          </td>
          <td>
            <div class="actions">
              <button class="btn btn-primary btn-sm" (click)="editUser(user)">
                <i class="fas fa-edit me-1"></i>Éditer
              </button>
              <button class="btn btn-danger btn-sm" (click)="deleteUser(user)"
                      [disabled]="user.username === currentUsername">
                <i class="fas fa-trash me-1"></i>Supprimer
              </button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Content: GUIDES -->
  <div class="tab-content" *ngIf="activeTab === 'guides'">
    <div class="section-header">
      <h2>Gestion des Guides</h2>
      <button class="btn btn-primary" (click)="openCreateGuideModal()">
        <i class="fas fa-plus me-2"></i>Créer un guide
      </button>
    </div>

    <div *ngIf="guides?.length === 0" class="empty-state">
      <i class="fas fa-map"></i>
      <p>Aucun guide pour le moment.</p>
    </div>

    <table *ngIf="guides?.length" class="data-table">
      <thead>
        <tr>
          <th>ID</th>
          <th>Nom</th>
          <th>Ville</th>
          <th>Catégorie</th>
          <th>Prix</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let guide of guides">
          <td>{{ guide.id }}</td>
          <td>{{ guide.name }}</td>
          <td>{{ guide?.city !== undefined && guide?.city !== null ? guide.city : '—' }}</td>
          <td>{{ guide?.category !== undefined && guide?.category !== null ? guide.category : '—' }}</td>
          <td>{{ guide?.price !== undefined && guide?.price !== null ? (guide.price + '€') : '—' }}</td>
          <td>
            <div class="actions">
              <a class="btn btn-primary btn-sm" [routerLink]="['/guide', guide.id]">
                <i class="fas fa-eye me-1"></i>Voir
              </a>
              <button class="btn btn-primary btn-sm" (click)="editGuide(guide)">
                <i class="fas fa-edit me-1"></i>Éditer
              </button>
              <button class="btn btn-danger btn-sm" (click)="deleteGuide(guide)">
                <i class="fas fa-trash me-1"></i>Supprimer
              </button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Content: INVITATIONS -->
  <div class="tab-content" *ngIf="activeTab === 'invitations'">
    <div class="section-header">
      <h2>Gestion des Invitations</h2>
      <button class="btn btn-primary" (click)="openCreateInvitationModal()">
        <i class="fas fa-plus me-2"></i>Créer une invitation
      </button>
    </div>

    <div *ngIf="invitations?.length === 0" class="empty-state">
      <i class="fas fa-envelope-open-text"></i>
      <p>Aucune invitation pour le moment.</p>
    </div>

    <table *ngIf="invitations?.length" class="data-table">
      <thead>
        <tr>
          <th>ID</th>
          <th>Guide</th>
          <th>Utilisateur Invité</th>
          <th>Email</th>
          <th>Date de Création</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let invitation of invitations">
          <td>{{ invitation.id }}</td>
          <td>{{ getGuideName(invitation.guide) }}</td>
          <td>{{ getUserName(invitation.invited_user) }}</td>
          <td>{{ invitation.invited_email }}</td>
          <td>{{ invitation.created_at | date:'short' }}</td>
          <td>
            <div class="actions">
              <button class="btn btn-danger btn-sm" (click)="deleteInvitation(invitation)">
                <i class="fas fa-trash me-1"></i>Supprimer
              </button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Messages -->
  <div *ngIf="message" class="message" [class.success]="messageType === 'success'"
       [class.error]="messageType === 'error'">
    {{ message }}
  </div>
</div>
