<section class="home">
  <div class="home-container">

    <div class="welcome-header">
      <h1>HWS Guides</h1>
      <p class="subtitle" *ngIf="!connected">Bienvenue ! Connecte-toi pour consulter tes guides.</p>
    </div>

    <!-- formulaire de connexion -->
    <ng-container *ngIf="!connected; else mesGuides">
      <div class="auth-card">
        <h2>Connexion</h2>
        <form [formGroup]="form" (ngSubmit)="onSubmit()" class="auth-form">
          <div class="form-group">
            <label class="form-label">Identifiant</label>
            <input type="text" formControlName="username" placeholder="nom d'utilisateur" class="form-input"
              (keyup.enter)="onSubmit()" />
          </div>

          <div class="form-group">
            <label class="form-label">Mot de passe</label>
            <input type="password" formControlName="password" placeholder="mot de passe" class="form-input"
              (keyup.enter)="onSubmit()" />
          </div>

          <button type="submit" [disabled]="loadingLogin || form.invalid" class="btn btn-primary submit-btn">
            {{ loadingLogin ? 'Connexion…' : 'Se connecter' }}
          </button>

          <div class="error" *ngIf="loginError">{{ loginError }}</div>
        </form>
        <p class="hint">Utilise un utilisateur de démo créé via le seeding de users.</p>
      </div>
    </ng-container>

    <!-- après connexion -->
    <ng-template #mesGuides>
      <div class="user-info">
        <div class="user-header">
          <div class="user-details">
            <h2>Mes guides</h2>
            <span class="user-role">Utilisateur connecté</span>
          </div>

          <!-- Actions groupées à droite avec espacement -->
          <div class="actions">
            <!-- Bouton Admin visible si admin -->
            <a *ngIf="isAdmin" routerLink="/admin" class="btn btn-tertiary">
              Administration
            </a>

            <button (click)="logout()" class="btn btn-secondary">
              Déconnexion
            </button>
          </div>
        </div>
      </div>

      <div class="guides-section">
        <div *ngIf="guidesLoading" class="empty-state">
          <p>Chargement des guides…</p>
        </div>

        <div class="error" *ngIf="guidesError">{{ guidesError }}</div>

        <ul class="guides-list" *ngIf="!guidesLoading && !guidesError && guides.length > 0">
          <li class="guide-item" *ngFor="let g of guides">
            <div class="guide-header">
              <h4>{{ g.title ?? g.name ?? 'Sans titre' }}</h4>
              <span class="guide-days">
                {{ (g.days ?? 0) }} jour{{ (g.days ?? 0) > 1 ? 's' : '' }}
              </span>
            </div>
            <p class="guide-description">{{ g.description ?? '—' }}</p>
            <div class="guide-transport">
              <span class="transport-tag">🚗 {{ g.mobility ?? '—' }}</span>
              <span class="transport-tag">🌤️ {{ g.season ?? '—' }}</span>
              <span class="transport-tag">👥 {{ g.audience ?? '—' }}</span>
            </div>
            <div class="guide-actions">
              <button class="btn btn-primary btn-detail" (click)="viewGuideDetails(g.id)">
                Voir détails →
              </button>
            </div>
          </li>
        </ul>

        <div class="empty-state" *ngIf="!guidesLoading && !guidesError && guides.length === 0">
          <p>Aucun guide disponible pour le moment.</p>
        </div>
      </div>
    </ng-template>

  </div>
</section>
